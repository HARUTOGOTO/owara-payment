<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>処理しています…</title>
<style>
  body{font-family:-apple-system,BlinkMacSystemFont,"Noto Sans JP",sans-serif;margin:0;padding:24px;text-align:center}
  .btn{display:inline-block;margin-top:16px;padding:10px 16px;border-radius:10px;background:#0d6efd;color:#fff;text-decoration:none}
  .note{color:#666;margin-top:12px}
</style>
</head>
<body>
  <h1 id="h">LINE に戻っています…</h1>
  <p class="note" id="m">自動で戻らない場合は下のボタンを押してください。</p>
  <a id="back" class="btn">LINE に戻る</a>

<script>
(function(){
  const q = new URLSearchParams(location.search);
  const liffId = q.get("liffId") || "";   // ← liffIds → liffId に修正（必須）

  if (!liffId) {
    document.getElementById("h").textContent = "LINE に戻れませんでした";
    document.getElementById("m").textContent = "この画面を閉じ、LINEトークからもう一度お試しください。";
    document.getElementById("back").style.display = "none";
    return;
  }

  const back = new URL(`https://liff.line.me/${encodeURIComponent(liffId)}`);
  for (const [k,v] of q.entries()) back.searchParams.set(k, v);

  const href = back.toString();
  document.getElementById("back").href = href;
  setTimeout(() => location.replace(href), 300);  // 履歴を汚さない
})();
</script>
</body>
</html>
